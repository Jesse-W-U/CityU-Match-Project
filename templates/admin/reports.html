<!-- templates/admin/reports.html -->
{% extends "admin/base.html" %}

{% block content %}
<style>
    :root {
        --red-1: rgb(133, 1, 45);
        --red-2: rgb(194, 0, 65);
        --red-3: rgb(254, 25, 102);
        --white: #FFFFFF;
        --gray-bg: #F5F7FA;
        --text-dark: #212529;
        --text-light: #6C757D;
        --border-color: #E9ECEF;
    }
    
    .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--red-2);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
    }
    
    .section-title i {
        margin-right: 0.5rem;
    }
    
    .table-responsive {
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }
    
    .table th {
        background: var(--gray-bg);
        color: var(--text-dark);
        font-weight: 600;
        padding: 0.75rem 1rem;
    }
    
    .table td {
        padding: 0.75rem 1rem;
        vertical-align: middle;
    }
    
    .table-hover tbody tr:hover {
        background: var(--gray-bg);
    }
    
    .badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .badge-pending {
        background: #ffc107;
        color: #856404;
    }
    
    .badge-resolved {
        background: #d4edda;
        color: #155724;
    }
    
    .action-btn {
        padding: 0.25rem 0.5rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        margin-right: 0.25rem;
        transition: all 0.2s ease;
    }
    
    .btn-success {
        background: #198754 !important;
        color: white !important;
        border: none;
    }
    
    .btn-success:hover {
        background: #157347 !important;
    }
    
    .btn-danger {
        background: #dc3545 !important;
        color: white !important;
        border: none;
    }
    
    .btn-danger:hover {
        background: #c82333 !important;
    }
    
    .report-description {
        max-height: 60px;
        overflow-y: auto;
        font-size: 0.875rem;
        color: var(--text-light);
    }
    
    .user-info {
        font-weight: 500;
        color: var(--text-dark);
    }
    
    .time-info {
        font-size: 0.8rem;
        color: var(--text-light);
    }
    
    .card {
        border: none;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    
    .card-header {
        background: linear-gradient(135deg, var(--red-1) 0%, var(--red-2) 100%);
        color: white;
        padding: 1.5rem;
        border: none;
    }
    
    .card-body {
        padding: 0;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="section-title">
        <i class="fas fa-flag"></i> Report Management
    </h2>
    <span class="badge bg-primary">
        Total Reports: {{ reports|length }}
    </span>
</div>

<div class="card">
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Reporter</th>
                    <th>Reported User</th>
                    <th>Reason</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Reported At</th>
                    <th>Resolved At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td><code>{{ report[0] }}</code></td>  <!-- id -->
                    <td>
                        <div class="user-info">{{ report[5] or report[1] }}</div>  <!-- reporter_name or reporter_id -->
                        <small>@{{ report[6] or report[1] }}</small>  <!-- reporter_nickname or reporter_id -->
                    </td>
                    <td>
                        <div class="user-info">{{ report[7] or report[2] }}</div>  <!-- reported_name or reported_id -->
                        <small>@{{ report[8] or report[2] }}</small>  <!-- reported_nickname or reported_id -->
                    </td>
                    <td>
                        <span class="badge bg-warning text-dark">{{ report[3] }}</span>  <!-- reason -->
                    </td>
                    <td>
                        <div class="report-description">
                            {{ report[4] or 'No description provided' }}  <!-- description -->
                        </div>
                    </td>
                    <td>
                        {% if report[9] == 'pending' %}  <!-- status -->
                        <span class="badge badge-pending">Pending</span>
                        {% elif report[9] == 'resolved' %}
                        <span class="badge badge-resolved">Resolved</span>
                        {% else %}
                        <span class="badge bg-secondary">{{ report[9]|title }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="time-info">
                            {% if report[10] %}  <!-- created_at -->
                                {% if report[10] is string %}
                                    {{ report[10] }}
                                {% else %}
                                    {{ report[10].strftime('%Y-%m-%d %H:%M') }}
                                {% endif %}
                            {% else %}
                                N/A
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        <div class="time-info">
                            {% if report[11] %}  <!-- resolved_at -->
                                {% if report[11] is string %}
                                    {{ report[11] }}
                                {% else %}
                                    {{ report[11].strftime('%Y-%m-%d %H:%M') }}
                                {% endif %}
                            {% else %}
                                N/A
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        {% if report[9] == 'pending' %}  <!-- status -->
                        <form method="POST" action="{{ url_for('admin.resolve_report', report_id=report[0]) }}" style="display: inline;" onsubmit="return confirm('Mark this report as resolved?')">
                            <button type="submit" class="action-btn btn-success">
                                <i class="fas fa-check"></i> Resolve
                            </button>
                        </form>
                        {% endif %}
                        
                        <form method="POST" action="{{ url_for('admin.delete_report', report_id=report[0]) }}" style="display: inline;" onsubmit="return confirm('Delete this report permanently?')">
                            <button type="submit" class="action-btn btn-danger">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if not reports %}
<div class="text-center py-5">
    <i class="fas fa-flag fa-3x text-muted mb-3"></i>
    <h4 class="text-muted">No Reports Found</h4>
    <p class="text-muted">All users are behaving well! ðŸ˜Š</p>
</div>
{% endif %}
{% endblock %}